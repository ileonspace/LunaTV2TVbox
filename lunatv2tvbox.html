<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lunatvåˆ°å½±è§†ä»“æ¥å£è½¬æ¢å™¨</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome ç”¨äºåˆ é™¤å›¾æ ‡ -->
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.2/css/all.min.css" rel="stylesheet">
    <!-- è‡ªå®šä¹‰ CSS -->
    <style>
        body {
            background: linear-gradient(135deg, #d1d5db, #e5e7eb);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 0.9rem;
            transition: background 0.3s;
        }
        .container {
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            padding: 15px;
            max-width: 700px;
            width: 90%;
            margin: 10px;
        }
        .dark-mode .container {
            background: #1f2937;
            color: #d1d5db;
        }
        .dark-mode body {
            background: linear-gradient(135deg, #374151, #4b5563);
        }
        h1 {
            font-size: 1.6rem;
            font-weight: 600;
            text-align: center;
            margin-bottom: 15px;
            color: #1f2937;
        }
        @media (max-width: 576px) {
            h1 {
                font-size: 1.4rem;
            }
        }
        .dark-mode h1 {
            color: #e5e7eb;
        }
        .form-label, .category-label {
            font-size: 0.95rem;
            font-weight: 500;
            margin-bottom: 5px;
        }
        textarea, #output {
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.8rem;
            border-radius: 6px;
            border: 1px solid #d1d5db;
            padding: 8px;
            color: #1f2937;
        }
        textarea::placeholder {
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.95rem;
            color: #6b7280;
        }
        .dark-mode textarea, .dark-mode #output {
            background: #374151;
            color: #d1d5db;
            border-color: #4b5563;
        }
        .dark-mode textarea::placeholder {
            color: #9ca3af;
            font-size: 0.95rem;
        }
        textarea {
            height: 120px;
            resize: none;
            width: 100%;
        }
        #output {
            background: #f9fafb;
            max-height: 200px;
            overflow-y: auto;
            width: 100%;
        }
        .btn {
            border-radius: 8px;
            padding: 6px;
            font-size: 0.85rem;
            font-weight: 500;
            border: 1px solid transparent;
            color: #f3f4f6;
            transition: all 0.2s ease;
            width: 100%;
            box-sizing: border-box;
        }
        .btn:hover {
            transform: scale(1.02);
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
        }
        .btn-convert, .btn-copy, .btn-download, .btn-add-category {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            border-color: #3b82f6;
        }
        .btn-reset-categories, .btn-clear-output, .btn-clear-categories {
            background: linear-gradient(135deg, #ef4444, #b91c1c);
            border-color: #ef4444;
        }
        .btn-theme-toggle {
            position: fixed;
            top: 10px;
            right: 10px;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            border-color: #3b82f6;
            color: #f3f4f6;
        }
        .category-tags {
            margin-bottom: 10px;
        }
        .category-tags .badge {
            font-size: 1rem;
            margin: 3px;
            padding: 5px 8px;
            background: #3b82f6;
            cursor: move;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            user-select: none;
        }
        @media (max-width: 576px) {
            .category-tags .badge {
                font-size: 1.0rem !important;
                padding: 4px 6px;
            }
        }
        .dark-mode .category-tags .badge {
            background: #4b5563;
        }
        .category-tags .badge i {
            font-size: 0.8rem;
            cursor: pointer;
        }
        .category-tags .badge.dragging {
            opacity: 0.5;
        }
        .category-section {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        @media (max-width: 576px) {
            .category-section {
                flex-direction: column;
            }
        }
        .category-input {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        .category-input input {
            font-size: 0.95rem;
            width: 50%;
        }
        @media (max-width: 576px) {
            .category-input input {
                width: 100%;
            }
            .category-input {
                flex-direction: column;
            }
            .category-input .btn-add-category {
                width: 100%;
            }
        }
        .category-buttons {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: nowrap;
        }
        .category-buttons .btn {
            flex: 1;
            min-width: 100px;
            text-align: center;
        }
        @media (max-width: 576px) {
            .category-buttons {
                flex-direction: row;
                flex-wrap: nowrap;
            }
            .category-buttons .btn {
                flex: 1;
                min-width: 0;
                font-size: 0.8rem;
                padding: 6px 8px;
            }
        }
        .button-group {
            display: flex;
            gap: 8px;
            align-items: center; /* å‚ç›´å±…ä¸­å¯¹é½ */
            flex-wrap: nowrap; /* ç¡®ä¿æŒ‰é’®åœ¨åŒä¸€è¡Œ */
        }
        .button-group .btn {
            flex: 1; /* æŒ‰é’®å¹³åˆ†å®½åº¦ */
            min-width: 100px; /* æœ€å°å®½åº¦ï¼Œé˜²æ­¢æŒ‰é’®è¿‡çª„ */
            text-align: center; /* æ–‡æœ¬å±…ä¸­ */
        }
        @media (max-width: 576px) {
            .button-group {
                flex-direction: row; /* ç§»åŠ¨ç«¯ä¿æŒæ°´å¹³æ’åˆ— */
                flex-wrap: nowrap; /* é˜²æ­¢æ¢è¡Œ */
            }
            .button-group .btn {
                flex: 1; /* å¹³åˆ†å®½åº¦ */
                min-width: 0; /* å…è®¸æŒ‰é’®åœ¨å°å±å¹•ä¸Šç¼©å° */
                font-size: 0.8rem; /* ç§»åŠ¨ç«¯ç¨å°å­—ä½“ */
                padding: 6px 8px; /* è°ƒæ•´ç§»åŠ¨ç«¯å†…è¾¹è· */
            }
        }
        .clear-output-group {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 8px;
        }
        @media (max-width: 576px) {
            .clear-output-group {
                flex-direction: row;
            }
            .clear-output-group .btn {
                flex: 1;
                min-width: 0;
            }
        }
        .alert {
            font-size: 0.75rem;
            margin-top: 8px;
            padding: 6px;
            border-radius: 6px;
            transition: opacity 0.3s ease;
        }
    </style>
</head>
<body>
    <button class="btn btn-theme-toggle" onclick="toggleTheme()">ğŸŒ™</button>
    <div class="container">
        <h1>Lunatvåˆ°å½±è§†ä»“æ¥å£è½¬æ¢å™¨</h1>
        
        <!-- åˆ†ç±»ç®¡ç† -->
        <div class="mb-3 category-section">
            <div class="col-md-6 col-12">
                <label class="category-label">å½“å‰åˆ†ç±»ï¼ˆè½»æŒ‰æ‹–åŠ¨å³å¯ï¼‰</label>
                <div class="category-tags" id="categoryTags"></div>
            </div>
            <div class="col-md-6 col-12">
                <label class="category-label">æ·»åŠ æ–°åˆ†ç±»</label>
                <div class="category-input">
                    <input type="text" id="newCategory" class="form-control" placeholder="è¾“å…¥æ–°åˆ†ç±»åç§°">
                    <button class="btn btn-add-category" onclick="addCategory()">æ·»åŠ </button>
                </div>
                <div class="category-buttons mt-2">
                    <button class="btn btn-reset-categories" onclick="resetCategories()">é‡ç½®åˆ†ç±»</button>
                    <button class="btn btn-clear-categories" onclick="clearCategories()">æ¸…é™¤åˆ†ç±»</button>
                </div>
            </div>
        </div>

        <!-- è¾“å…¥ JSON -->
        <div class="mb-3">
            <label for="inputJson" class="form-label">è¯·è¾“å…¥Lunatvæ¥å£Json</label>
            <textarea id="inputJson" class="form-control" placeholder="ç²˜è´´Lunatv config.json å†…å®¹"></textarea>
        </div>
        <button class="btn btn-convert" onclick="convertJson()">è½¬æ¢</button>

        <!-- è¾“å‡ºç»“æœ -->
        <div class="mb-3 mt-3">
            <label for="output" class="form-label">è½¬æ¢åçš„å½±è§†ä»“æ¥å£Json</label>
            <div id="output" class="form-control"></div>
        </div>
        <div class="button-group">
            <button class="btn btn-copy" onclick="copyOutput()">å¤åˆ¶ç»“æœ</button>
            <button class="btn btn-download" onclick="downloadOutput()">ä¸‹è½½ Json æ–‡ä»¶</button>
        </div>
        <div class="clear-output-group">
            <button class="btn btn-clear-output" onclick="clearOutput()">æ¸…é™¤è¾“å‡º</button>
        </div>
        <div id="alert" class="alert" role="alert" style="display: none;"></div>
    </div>

    <!-- Bootstrap JS å’Œ Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // é»˜è®¤åˆ†ç±»
        let categories = ["å›½äº§å‰§", "åŠ¨ä½œç‰‡", "å–œå‰§ç‰‡", "ç§‘å¹»ç‰‡", "çˆ±æƒ…ç‰‡", "çºªå½•ç‰‡", "åŠ¨ç”»ç‰‡", "æ¬§ç¾å‰§", "é¦™æ¸¯å‰§", "çŸ­å‰§"];
        let draggedCategory = null;

        // åˆå§‹åŒ–åˆ†ç±»æ ‡ç­¾
        function renderCategories() {
            const categoryTags = document.getElementById('categoryTags');
            categoryTags.innerHTML = '';
            categories.forEach(category => {
                const badge = document.createElement('span');
                badge.className = 'badge';
                badge.draggable = true;
                badge.innerHTML = `${category} <i class="fas fa-times"></i>`;
                
                // é¼ æ ‡æ‹–æ‹½äº‹ä»¶
                badge.ondragstart = (e) => {
                    draggedCategory = category;
                    badge.classList.add('dragging');
                    e.dataTransfer.setData('text/plain', category);
                };
                badge.ondragend = () => {
                    badge.classList.remove('dragging');
                    draggedCategory = null;
                };
                badge.ondragover = (e) => e.preventDefault();
                badge.ondrop = (e) => {
                    e.preventDefault();
                    const targetCategory = category;
                    const draggedIndex = categories.indexOf(draggedCategory);
                    const targetIndex = categories.indexOf(targetCategory);
                    if (draggedIndex !== -1 && targetIndex !== -1 && draggedIndex !== targetIndex) {
                        categories.splice(draggedIndex, 1);
                        categories.splice(targetIndex, 0, draggedCategory);
                        renderCategories();
                    }
                };

                // è§¦æ‘¸æ‹–æ‹½äº‹ä»¶
                badge.ontouchstart = (e) => {
                    draggedCategory = category;
                    badge.classList.add('dragging');
                };
                badge.ontouchmove = (e) => {
                    e.preventDefault();
                    const touch = e.touches[0];
                    const target = document.elementFromPoint(touch.clientX, touch.clientY);
                    if (target && target.classList.contains('badge') && target !== badge) {
                        const targetCategory = target.textContent.split(' ')[0];
                        const draggedIndex = categories.indexOf(draggedCategory);
                        const targetIndex = categories.indexOf(targetCategory);
                        if (draggedIndex !== -1 && targetIndex !== -1 && draggedIndex !== targetIndex) {
                            categories.splice(draggedIndex, 1);
                            categories.splice(targetIndex, 0, draggedCategory);
                            renderCategories();
                        }
                    }
                };
                badge.ontouchend = () => {
                    badge.classList.remove('dragging');
                    draggedCategory = null;
                };

                // åˆ é™¤äº‹ä»¶
                badge.querySelector('i').onclick = (e) => {
                    e.stopPropagation();
                    if (confirm(`ç¡®è®¤åˆ é™¤åˆ†ç±» "${category}" å—ï¼Ÿ`)) {
                        removeCategory(category);
                    }
                };
                categoryTags.appendChild(badge);
            });
        }

        // æ·»åŠ åˆ†ç±»
        function addCategory() {
            const newCategoryInput = document.getElementById('newCategory');
            const newCategory = newCategoryInput.value.trim();
            if (newCategory && !categories.includes(newCategory)) {
                categories.push(newCategory);
                renderCategories();
                newCategoryInput.value = '';
                showAlert('åˆ†ç±»æ·»åŠ æˆåŠŸï¼', 'alert-success');
            } else {
                showAlert('åˆ†ç±»å·²å­˜åœ¨æˆ–è¾“å…¥ä¸ºç©ºï¼', 'alert-warning');
            }
        }

        // åˆ é™¤åˆ†ç±»
        function removeCategory(category) {
            categories = categories.filter(c => c !== category);
            renderCategories();
            showAlert('åˆ†ç±»åˆ é™¤æˆåŠŸï¼', 'alert-success');
        }

        // é‡ç½®åˆ†ç±»
        function resetCategories() {
            categories = ["å›½äº§å‰§", "åŠ¨ä½œç‰‡", "å–œå‰§ç‰‡", "ç§‘å¹»ç‰‡", "çˆ±æƒ…ç‰‡", "çºªå½•ç‰‡", "åŠ¨ç”»ç‰‡", "æ¬§ç¾å‰§", "é¦™æ¸¯å‰§", "çŸ­å‰§"];
            renderCategories();
            showAlert('åˆ†ç±»å·²é‡ç½®ï¼', 'alert-success');
        }

        // æ¸…é™¤åˆ†ç±»
        function clearCategories() {
            categories = [];
            renderCategories();
            showAlert('åˆ†ç±»å·²æ¸…é™¤ï¼', 'alert-success');
        }

        // JSON è½¬æ¢
        function convertJson() {
            const input = document.getElementById('inputJson').value;
            const outputDiv = document.getElementById('output');
            const alertDiv = document.getElementById('alert');

            try {
                const inputJson = JSON.parse(input);
                const apiSite = inputJson.api_site || {};
                const sites = Object.keys(apiSite).map(key => ({
                    key: key,
                    name: apiSite[key].name,
                    type: 1,
                    api: apiSite[key].api + (apiSite[key].api.includes('?') ? '&ac=list' : '/?ac=list'),
                    searchable: 1,
                    quickSearch: 1,
                    filterable: 1,
                    categories: categories
                }));
                const outputJson = { sites };
                outputDiv.textContent = JSON.stringify(outputJson, null, 2);
                alertDiv.style.display = 'none';
            } catch (e) {
                alertDiv.className = 'alert alert-danger';
                alertDiv.textContent = 'JSON æ ¼å¼é”™è¯¯ï¼Œè¯·æ£€æŸ¥è¾“å…¥ï¼';
                alertDiv.style.display = 'block';
                outputDiv.textContent = '';
            }
        }

        // å¤åˆ¶ç»“æœ
        function copyOutput() {
            const output = document.getElementById('output').textContent;
            if (output) {
                navigator.clipboard.writeText(output).then(() => {
                    showAlert('å¤åˆ¶æˆåŠŸï¼', 'alert-success');
                });
            }
        }

        // ä¸‹è½½ JSON
        function downloadOutput() {
            const output = document.getElementById('output').textContent;
            if (output) {
                const blob = new Blob([output], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'leontv_config.json';
                a.click();
                URL.revokeObjectURL(url);
            }
        }

        // æ¸…é™¤è¾“å‡º
        function clearOutput() {
            const outputDiv = document.getElementById('output');
            outputDiv.textContent = '';
            showAlert('è¾“å‡ºå·²æ¸…é™¤ï¼', 'alert-success');
        }

        // æ˜¾ç¤ºæç¤º
        function showAlert(message, className) {
            const alertDiv = document.getElementById('alert');
            alertDiv.className = `alert ${className}`;
            alertDiv.textContent = message;
            alertDiv.style.display = 'block';
            setTimeout(() => { alertDiv.style.display = 'none'; }, 2000);
        }

        // åˆ‡æ¢ä¸»é¢˜
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const btn = document.querySelector('.btn-theme-toggle');
            btn.textContent = document.body.classList.contains('dark-mode') ? 'â˜€ï¸' : 'ğŸŒ™';
        }

        // åˆå§‹åŒ–é¡µé¢
        renderCategories();
    </script>
</body>
</html>
